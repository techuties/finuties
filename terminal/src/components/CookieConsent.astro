---
/**
 * Cookie consent banner.
 * - Shows on first visit (no localStorage value).
 * - "Accept All" → loads full Metrility pixel, stores 'accepted'.
 * - "Essential Only" → stores 'declined', GDPR pixel still active.
 * - Returning visitors with a stored preference never see the banner.
 */
---

<div
  id="cookie-consent"
  class="fixed bottom-0 left-0 right-0 z-[9999] hidden border-t border-fin-border/20 bg-fin-900 text-white shadow-lg"
  role="region"
  aria-label="Cookie consent"
>
  <div class="mx-auto flex max-w-[1200px] flex-col items-start gap-4 px-4 py-4 sm:flex-row sm:items-center sm:gap-6 sm:px-6 lg:px-8">
    <p class="flex-1 text-sm leading-relaxed text-slate-300">
      We use cookies to improve your experience. Accept all cookies for enhanced analytics, or continue with essential tracking only.
      <a href="/cookies" class="ml-1 text-fin-400 underline hover:text-white">Learn more</a>
    </p>
    <div class="flex shrink-0 gap-3">
      <button
        id="cookie-accept"
        type="button"
        class="rounded-lg bg-fin-600 px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-fin-500 focus:outline-none focus:ring-2 focus:ring-fin-400 focus:ring-offset-2 focus:ring-offset-fin-900"
      >
        Accept All
      </button>
      <button
        id="cookie-decline"
        type="button"
        class="rounded-lg border border-slate-500 px-4 py-2 text-sm font-medium text-slate-300 transition-colors hover:bg-slate-800/50 focus:outline-none focus:ring-2 focus:ring-fin-400 focus:ring-offset-2 focus:ring-offset-fin-900"
      >
        Essential Only
      </button>
    </div>
  </div>
</div>

<script is:inline>
  (function () {
    var STORAGE_KEY = 'fin_cookie_consent';
    var banner = document.getElementById('cookie-consent');
    var stored = localStorage.getItem(STORAGE_KEY);

    if (stored === 'accepted' || stored === 'declined') {
      // Returning visitor — banner stays hidden.
      return;
    }

    // First visit — show banner.
    if (banner) banner.classList.remove('hidden');

    function hideBanner() {
      if (banner) banner.classList.add('hidden');
    }

    function loadFullPixel() {
      var s = document.createElement('script');
      s.defer = true;
      s.src = 'https://metrility.techuties.com/pixel/zO8DpTMfzda1A6MJ';
      document.head.appendChild(s);
    }

    var acceptBtn = document.getElementById('cookie-accept');
    var declineBtn = document.getElementById('cookie-decline');

    if (acceptBtn) {
      acceptBtn.addEventListener('click', function () {
        localStorage.setItem(STORAGE_KEY, 'accepted');
        loadFullPixel();
        hideBanner();
      });
    }

    if (declineBtn) {
      declineBtn.addEventListener('click', function () {
        localStorage.setItem(STORAGE_KEY, 'declined');
        hideBanner();
      });
    }
  })();
</script>
